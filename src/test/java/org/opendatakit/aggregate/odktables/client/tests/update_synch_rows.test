# Set up
createUser user1
createUser user2

createSynchronizedTable user1 people
    name STRING false
    age INTEGER false
    weight DECIMAL false
    
setTablePermissions user1 user2 people true false false
    
insertSynchronizedRows user1 people 
    row1
        name Dylan
        age 22
        weight 175
    row2
        name John
        age 50
        weight 200
    
    
# Test that user can update rows
updateSynchronizedRows user1 people
    row1
        name DylanPrice
        age 23
        weight 200
        
        
# Test that user can't update non-existent table
updateSynchronizedRows user1 nonexistenttable 
    row1
        name DylanPriceAgain
        age 24
        weight 201
        
        
# Test that user can't update non-existent columns
updateSynchronizedRows user1 people 
    row1
        name DylanPriceAgain
        age 24
        weight 201
        nosuchcolumn value
        
        
# Test that user2 can't update without permission
cloneSynchronizedTable user2 people
updateSynchronizedRows user2 people
    row1
        name DylanPriceAgain
        age 24
        weight 201
        
        
# Test that user2 can't update when has permission but not synchronized
updateSynchronizedRows user1 people
    row1
        name DylanPriceAgain
        age 24
        weight 201
        
setTablePermissions user1 user2 people true true false

updateSynchronizedRows user2 people
    row1
        name NotDylanPrice
        age 75
        weight 147

        
# Test that user2 can update rows when has permission and is synchronized
synchronize user2 people
updateSynchronizedRows user2 people
    row1
        name NotDylanPrice
        age 75
        weight 147

 
# Clean up
deleteSynchronizedTable user1 people
deleteUser user1
deleteUser user2
 