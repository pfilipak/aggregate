# Set up
createUser user1
createUser user2

createSynchronizedTable user1 people
    
setTablePermissions user1 user2 people true false false
    
    
# Test that user can insert rows
insertSynchronizedRows user1 people 
        
        
# Test that user can't insert to non-existent table
insertSynchronizedRows user1 nonexistenttable 
Exception: org.opendatakit.aggregate.odktables.client.exception.TableDoesNotExistException: Table with ID nonexistenttable does not exist!
        
        
# Test that user can't insert to non-existent columns
insertSynchronizedRows user1 people 
Exception: org.opendatakit.aggregate.odktables.client.exception.ColumnDoesNotExistException: Column with name nosuchcolumn does not exist in table with tableID people
        
        
# Test that user2 can't insert without permission
cloneSynchronizedTable user2 people
insertSynchronizedRows user2 people
Exception: org.opendatakit.aggregate.odktables.client.exception.PermissionDeniedException: Requesting user does not have permission for that operation!
        
        
# Test that user2 can't insert when has permission but not synchronized
insertSynchronizedRows user1 people
        
setTablePermissions user1 user2 people true true false

insertSynchronizedRows user2 people
Exception: org.opendatakit.aggregate.odktables.client.exception.OutOfSynchException: Table out of synch with Aggregate!.

        
# Test that user2 can insert rows when has permission and is synchronized
synchronize user2 people
insertSynchronizedRows user2 people
 
 
# Clean up
deleteSynchronizedTable user1 people
deleteUser user1
deleteUser user2
 